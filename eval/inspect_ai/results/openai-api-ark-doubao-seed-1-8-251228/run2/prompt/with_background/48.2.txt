PROBLEM DESCRIPTION:
You will be provided with problem steps along with background knowledge necessary for solving the problem. Your task will be to develop a Python solution focused on the next step of the problem-solving process.

PROBLEM STEPS AND FUNCTION CODE:
Here, you'll find the Python code for the initial steps of the problem-solving process. This code is integral to building the solution.

Convert diffractometer angles to the in-plane momentum transfer, $q$, and to the out-of-plane momenta of the incident and scattered electron, $k_i^z$ and $k_s^z$. Momentum transfer $Q$ is defined as $Q = \vec{k_s} - \vec{k_i}$. Assume the sample surface normal is along the $+z$ direction and the scattering plane lies in the $x-z$ plane. $k_i^z$ is along the $+z$ direction, $k_s^z$ is along the $-z$ direction, and $k_i^x$, $k_s^x$ are along the $+x$ direction. Using the electron mass $m_e = 0.51099895 $ MeV/$c^2$ and Planck's constant $hc = 1239.84193$ eV nm
Background 
electron momentum in the nonrelativistic limit is given by:
$$k = \frac{\sqrt{2mE}}{\hbar}$$
where $E$ is the electron energy and $m$ is the mass of a stationary electron.



def q_cal(th, gamma, E0, omega):
    '''Calculate the in-plane momentum q, and out-of-plane momenta of the incident and scattered electron k_i_z and k_s_z.
    Ensure that the signs of q, k_i_z and k_s_z are correctly represented.
    Input 
    th, angle between the incident electron and the sample surface normal is 90-th, a list of float in the unit of degree
    gamma, angle between the incident and scattered electron, a list of float in the unit of degree
    E0, incident electron energy, float in the unit of eV
    omega, energy loss, a list of float in the unit of eV
    Output
    Q: a tuple (q,k_i_z,k_s_z) in the unit of inverse angstrom, where q is in-plane momentum, 
       and k_i_z and k_s_z are out-of-plane momenta of the incident and scattered electron    
    '''
    # Fundamental constants with correct unit conversions
    m_e_c2 = 510998.95  # eV, m_e*c² = 0.51099895 MeV converted to eV
    hc = 1239.84193     # eV·nm, given Planck's constant times speed of light
    hbar_c_ang = (hc / (2 * np.pi)) * 10  # Convert hbar*c from eV·nm to eV·Å (1 nm = 10 Å)
    
    # Precompute constant factor for wavevector calculation (Å⁻¹ / sqrt(eV))
    sqrt_2mec2 = np.sqrt(2 * m_e_c2)
    k_const = sqrt_2mec2 / hbar_c_ang
    
    # Convert input lists to numpy arrays for vectorized operations
    th_arr = np.array(th)
    gamma_arr = np.array(gamma)
    omega_arr = np.array(omega)
    
    # Calculate incident angle relative to surface normal (theta_i) in radians
    theta_i_deg = 90 - th_arr
    theta_i_rad = np.deg2rad(theta_i_deg)
    
    # Calculate scattered angle relative to surface normal (theta_s) in radians
    theta_s_deg = theta_i_deg + gamma_arr
    theta_s_rad = np.deg2rad(theta_s_deg)
    
    # Calculate magnitudes of incident and scattered electron wavevectors
    k_i = k_const * np.sqrt(E0)
    k_s = k_const * np.sqrt(E0 - omega_arr)
    
    # Compute out-of-plane (z) components
    k_i_z = k_i * np.cos(theta_i_rad)  # Positive since incident z-component is along +z
    k_s_z = k_s * np.cos(theta_s_rad)  # Negative since scattered z-component is along -z
    
    # Compute in-plane (x) components and momentum transfer
    k_i_x = k_i * np.sin(theta_i_rad)
    k_s_x = k_s * np.sin(theta_s_rad)
    q = k_s_x - k_i_x  # In-plane momentum transfer
    
    return (q, k_i_z, k_s_z)


NEXT STEP - PROBLEM STEP AND FUNCTION HEADER:
This part will describe the next step in the problem-solving process. A function header will be provided, and your task is to develop the Python code for this next step based on the provided description and function header.

Calculate Coulomb matrix element, $V_{\mathrm{eff}} (\tilde{Q})$, from the diffractometer angles. The effective Coulomb interaction is expressed in reciprocal space at momentum $\tilde{Q} = (q,\kappa)$ where $\kappa = k_i^z + k_s^z$
Background 
Coulomb matrix element in the low $q$ limit, $q \sim 0$, is given by:
$$V_{\mathrm{eff}}(q) = \dfrac{4\pi e^2}{q^2+(k_i^z + k_s^z)^2}$$

def MatELe(th, gamma, E0, omega):
    '''Calculate the Coulomb matrix element in the cgs system using diffractometer angles and the electron energy. 
    For simplicity, assume 4\pi*e^2 = 1 where e is the elementary charge. 
    Input 
    th, angle between the incident electron and the sample surface normal is 90-th, a list of float in the unit of degree
    gamma, angle between the incident and scattered electron, a list of float in the unit of degree
    E0, incident electron energy, float in the unit of eV
    omega, energy loss, a list of float in the unit of eV
    Output
    V_eff: matrix element in the unit of the inverse of square angstrom, a list of float
    '''

    return V_eff

DEPENDENCIES:
Use only the following dependencies in your solution. Do not include these dependencies at the beginning of your code.

import numpy as np
import scipy.interpolate as interpolate

RESPONSE GUIDELINES:
Now, based on the instructions and information provided above, write the complete and executable Python program for the next step in a single block.
Your response should focus exclusively on implementing the solution for the next step, adhering closely to the specified function header and the context provided by the initial steps.
Your response should NOT include the dependencies and functions of all previous steps. If your next step function calls functions from previous steps, please make sure it uses the headers provided without modification.
DO NOT generate EXAMPLE USAGE OR TEST CODE in your response. Please make sure your response python code in format of ```python```.